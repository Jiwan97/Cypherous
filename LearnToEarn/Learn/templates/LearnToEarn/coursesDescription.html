{% extends 'layout.html' %}
{% load static %}
{% load getEnroll %}
{% load hasLiked %}
{% load getLikes %}
{% load stars %}
{% load getStars %}
{% load getReview %}
{% load bootstrap %}
{% block title %}
    <title>Learn To Earn</title>
{% endblock%}

{% block content %}
<style>
    .btn-darkpink {
    background-color: #cb295e;
    width: 150px;
    color: #fff;
    border-radius: 20px;

    }
    .col-sm-2 {
    max-width:400% !important;
    }
    p a{
    color:#0645ad !important;
    }
</style>
<link rel="stylesheet" href="{% static 'typography.css'%}">
    <div class="all-title-box">
		<div class="container text-center">
			<h1>Recent News<span class="m_1">Lorem Ipsum dolroin gravida nibh vel velit.</span></h1>
		</div>
	</div>
    <section id="corses-singel" class="pt-20 pb-120 gray-bg">
        {% if enrollment %}
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="corses-singel-left mt-30">
                        <div class="title">
                            <h3>{{course.course_name}}</h3>
                        </div>
                        <div class="course-terms">
                            <ul>
                                <li>
                                    <div class="teacher-name">
                                        <div class="thum">
                                            <img src="/{{course.user.profile.profile_pic}}" alt="Teacher">
                                        </div>
                                        <div class="name">
                                            <span>Course Uploaded by</span>
                                            <h6>{{course.user.profile.firstname}} {{course.user.profile.lastname}}</h6>
                                        </div>
                                    </div>
                                </li>
                                <li>
                                    <div class="course-category">
                                        <span>Category</span>
                                        {% for tag in course.category.all|slice:1 %}
                                        <h6>{{tag}} </h6>
                                        {% endfor %}
                                    </div>
                                </li>
                                <li>
                                    <div class="review">
                                        <span>Review</span>
                                        <ul>
                                            {% if course.id|getStars %}
                                            {% for i in course.id|getStars %}
                                                <li><a href="#"><i class="fa fa-star"></i></a></li>
                                            {% endfor %}
                                            {% else %}
                                                <li><a href="#"><i class="fa fa-star"></i></a></li>
                                                <li><a href="#"><i class="fa fa-star"></i></a></li>
                                                <li><a href="#"><i class="fa fa-star"></i></a></li>
                                                <li><a href="#"><i class="fa fa-star"></i></a></li>
                                                <li><a href="#"><i class="fa fa-star"></i></a></li>
                                            {% endif %}
                                                <li class="rating">({{course.id|getReview}} Reviews)</li>
                                        </ul>
                                    </div>
                                </li>
                            </ul>
                        </div>

                        <div class="corses-singel-image pt-50">
                            <img src="/{{course.course_pic}}" alt="Courses">
                        </div>

                        <div class="corses-tab mt-30">
                            <ul class="nav nav-justified" id="myTab" role="tablist">
                                <li class="nav-item">
                                    <a class="active" id="overview-tab" data-toggle="tab" href="#overview" role="tab" aria-controls="overview" aria-selected="true">Overview</a>
                                </li>
                                <li class="nav-item">
                                    <a id="curriculam-tab" data-toggle="tab" href="#curriculam" role="tab" aria-controls="curriculam" aria-selected="false">Curriculam</a>
                                </li>
                                <li class="nav-item">
                                    <a id="reviews-tab" data-toggle="tab" href="#reviews" role="tab" aria-controls="reviews" aria-selected="false">Reviews</a>
                                </li>
                            </ul>

                            <div class="tab-content" id="myTabContent">
                                <div class="tab-pane fade show active" id="overview" role="tabpanel" aria-labelledby="overview-tab">
                                    <div class="overview-description">
                                        <div class="singel-description pt-40">
                                            <h6>Course Summery</h6>
                                            <p>{{course.course_summary}}</p>
                                        </div>
                                        <div class="singel-description pt-40">
                                            <h6>What u need to know before Learning this Course?</h6>
                                            <p>{{course.to_learn|safe}}</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="curriculam" role="tabpanel" aria-labelledby="curriculam-tab">
                                    {% if lesson %}
                                    <div class="curriculam-cont">
                                        <div class="title">
                                            <h6>{{course.course_name}}</h6>
                                        </div>
                                        <div class="accordion" id="accordionExample">
                                            {% for lesson in lesson %}
                                            <div class="card">
                                                <div class="card-header" id="heading{{lesson.modulenumber}}">
                                                    <a href="#" data-toggle="collapse" class="collapsed" data-target="#{{lesson.modulenumber}}" aria-expanded="false" aria-controls="{{lesson.modulenumber}}">
                                                        <ul>
                                                            <li><i class="fa fa-file-o"></i></li>
                                                            <li><span class="lecture">Lecture {{lesson.modulenumber}}</span></li>
                                                            <li><span class="head">{{lesson.module}}</span></li>
                                                            <li><span class="time d-none d-md-block"><i class="fa fa-clock-o"></i> <span> {{lesson.get_readtime}}</span></span></li>
                                                        </ul>
                                                    </a>
                                                </div>
                                                <div id="{{lesson.modulenumber}}" class="collapse" aria-labelledby="headingSeven" data-parent="#accordionExample">
                                                    <div class="card-body">
                                                        {{lesson.ModuleLecture|safe}}
                                                    </div>
                                                </div>
                                            </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    {% else %}
                                    <div class="overview-description">
                                        <div class="singel-description pt-40">
                                            <p>No Lesson/Modules Have been Updated for this course</p>
                                        </div>
                                    </div>
                                    {% endif %}
                                </div>
                                <div class="tab-pane fade" id="reviews" role="tabpanel" aria-labelledby="reviews-tab">
                                    <div class="reviews-cont">
                                        <div class="title">
                                            <h6>Student Reviews</h6>
                                        </div>
                                        <ul>
                                        {% if comments %}
                                           {% for comment in comments %}
                                           <li>
                                               <div class="singel-reviews">
                                                    <div class="reviews-author">
                                                        <div class="author-thum">
                                                            <img src="/{{comment.user.profile.profile_pic}}" alt="Reviews">
                                                        </div>
                                                        <div class="author-name">
                                                            <h6>{{comment.user.profile.firstname}} {{comment.user.profile.lastname}}</h6>
                                                            <span>{{comment.date_commented| date:"F d, Y"}}</span>
                                                        </div>
                                                    </div>
                                                    <div class="reviews-description pt-20">
                                                        <div class="rating">
                                                            <ul>
                                                                {% for i in comment.id|stars %}
                                                                <li><i style="font-size:12px;" class="fa fa-star"></i></li>
                                                                {% endfor %}
                                                            </ul>
                                                        </div>
                                                        <p style="white-space: pre-line;">{{comment.comment}}</p>
                                                    </div>
                                                </div>
                                           </li>
                                           {% endfor %}
                                        {% else %}
                                        <h6 class="mt-3">Be the first one to give a review to this course</h6>
                                        {% endif %}
                                        </ul>
                                        <div class="title pt-15">
                                            <h6>Leave A Comment</h6>
                                        </div>
                                        <div class="reviews-form">
                                            {% if can_review %}
                                            <h6 class="font-weight-bold mt-3">You have already reviewed this course</h6>
                                            {% else %}
                                            <form method="POST" action="#">
                                                {% csrf_token %}
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="form-singel" style="margin-left:-14px;">
                                                            {{review| bootstrap_horizontal}}
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-12">
                                                        <div class="form-singel">
                                                            <textarea required name="comment-message" placeholder="Comment"></textarea>
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-12">
                                                        <div class="form-singel">
                                                            <button type="submit"  class="btn main-btn">Post Review</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </form>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-8">
                    <div class="releted-courses pt-20">
                        <div class="title">
                            <h3>Releted Courses</h3>
                        </div>
                        <div class="row">
                            {% for course in related %}
                            <div class="col-md-6">
                                <div class="singel-course mt-20">
                                    <div class="thum">
                                        <div class="image">
                                            <img src="/{{course.course_pic}}" alt="Course">
                                        </div>
                                        <div class="price">
                                            <span>Free</span>
                                        </div>
                                    </div>
                                    <div class="cont">
                                        <ul>
                                            {% if course.id|getStars %}
                                            {% for i in course.id|getStars %}
                                                <li><i class="fa fa-star"></i></li>
                                            {% endfor %}
                                            {% else %}
                                                <li><i class="fa fa-star"></i></li>
                                                <li><i class="fa fa-star"></i></li>
                                                <li><i class="fa fa-star"></i></li>
                                                <li><i class="fa fa-star"></i></li>
                                                <li><i class="fa fa-star"></i></li>
                                            {% endif %}
                                        </ul>
                                        <span>({{course.id|getReview}} Reviws)</span>
                                        <a href="/courses/courseDesk/{{course.id}}"><h4>{{course.course_name}}</h4></a>
                                        <div class="course-teacher">
                                            <div class="thum">
                                                <a href="#"><img src="/{{course.user.profile.profile_pic}}" alt="teacher"></a>
                                            </div>
                                            <div class="name">
                                                <a href="#"><h6>{{course.user.profile.firstname}} {{course.user.profile.lastname}}</h6></a>
                                            </div>
                                            <div class="admin">
                                                <ul>
                                                    <li><a href="#"><i class="fa fa-user"></i><span>{{course.id|getEnroll}}</span></a></li>
                                                    {% if request.user|hasLiked:course.id %}
                                                    <li><a><i id="like-{{course.id}}" onclick="like({{course.id}})" class="fa fa-heart" style="cursor:pointer; color:#ffc600"></i><span id="count-{{course.id}}" >{{course.id|getLikes}}</span></a></li>
                                                    {% else %}
                                                    <li><a><i id="like-{{course.id}}" onclick="like({{course.id}})" class="fa fa-heart" style="cursor:pointer;"></i><span id="count-{{course.id}}" >{{course.id|getLikes}}</span></a></li>
                                                    {% endif %}
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="row sticky-top">
                        <div class="col-lg-12 col-md-6">
                            <div class="You-makelike mt-30">
                                <h4>Other Courses</h4>
                                {% for course in courselike %}
                                <div class="singel-makelike mt-20">
                                    <div class="image">
                                        <img src="{% static 'images/slider-01.jpg'%}" alt="Image">
                                    </div>
                                    <div class="cont">
                                        <a href="/courses/courseDesk/{{course.id}}"><h4>{{course.course_name}}</h4></a>
                                        <ul>
                                            <li><a href="#"><i class="fa fa-user"></i>{{course.id|getEnroll}}</a></li>
                                            <li>Free</li>
                                        </ul>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% else %}
        <div class="container">
            <div class="row">
                <div class="col-lg-8">
                    <div class="corses-singel-left mt-30">
                        <div class="title">
                            <h3>{{course.course_name}}</h3>
                        </div>
                        <div class="course-terms">
                            <ul>
                                <li>
                                    <div class="teacher-name">
                                        <div class="thum">
                                            <img src="/{{course.user.profile.profile_pic}}" alt="Teacher">
                                        </div>
                                        <div class="name">
                                            <span>Course Uploaded by</span>
                                            <h6>{{course.user.profile.firstname}} {{course.user.profile.lastname}}</h6>
                                        </div>
                                    </div>
                                </li>
                                <li>
                                    <div class="course-category">
                                        <span>Category</span>
                                        {% for tag in course.category.all|slice:1 %}
                                        <h6>{{tag}} </h6>
                                        {% endfor %}
                                    </div>
                                </li>
                                <li>
                                    <div class="review">
                                        <span>Review</span>
                                        <ul>
                                            {% if course.id|getStars %}
                                            {% for i in course.id|getStars %}
                                                <li><a href="#"><i class="fa fa-star"></i></a></li>
                                            {% endfor %}
                                            {% else %}
                                                <li><a href="#"><i class="fa fa-star"></i></a></li>
                                                <li><a href="#"><i class="fa fa-star"></i></a></li>
                                                <li><a href="#"><i class="fa fa-star"></i></a></li>
                                                <li><a href="#"><i class="fa fa-star"></i></a></li>
                                                <li><a href="#"><i class="fa fa-star"></i></a></li>
                                            {% endif %}
                                                <li class="rating">({{course.id|getReview}} Reviews)</li>
                                        </ul>
                                    </div>
                                </li>
                            </ul>
                        </div>

                        <div class="corses-singel-image pt-50">
                            <img src="/{{course.course_pic}}" alt="Courses">
                        </div>

                        <div class="corses-tab mt-30">
                            <ul class="nav nav-justified" id="myTab" role="tablist">
                                <li class="nav-item">
                                    <a class="active" id="overview-tab" data-toggle="tab" href="#overview" role="tab" aria-controls="overview" aria-selected="true">Overview</a>
                                </li>
                                <li class="nav-item">
                                    <a id="curriculam-tab" data-toggle="tab" href="#curriculam" role="tab" aria-controls="curriculam" aria-selected="false">Curriculam</a>
                                </li>
                                <li class="nav-item">
                                    <a id="reviews-tab" data-toggle="tab" href="#reviews" role="tab" aria-controls="reviews" aria-selected="false">Reviews</a>
                                </li>
                            </ul>

                            <div class="tab-content" id="myTabContent">
                                <div class="tab-pane fade show active" id="overview" role="tabpanel" aria-labelledby="overview-tab">
                                    <div class="overview-description">
                                        <div class="singel-description pt-40">
                                            <h6>Course Summery</h6>
                                            <p>{{course.course_summary}}</p>
                                        </div>
                                        <div class="singel-description pt-40">
                                            <h6>What u need to know before Learning this Course?</h6>
                                            <p>{{course.to_learn|safe}}</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="curriculam" role="tabpanel" aria-labelledby="curriculam-tab">
                                    <div class="overview-description">
                                        <div class="singel-description pt-40">
                                            <h6>Haven't you enrolled yet?</h6>
                                            <p>You can enroll this course by clicking on Enroll Now on the right side of your screen</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="reviews" role="tabpanel" aria-labelledby="reviews-tab">
                                    <div class="overview-description">
                                        <div class="singel-description pt-40">
                                            <h6>Haven't you enrolled yet?</h6>
                                            <p>In order to give review you must be Enrolled to this course</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="row sticky-top">
                        <div class="col-lg-12 col-md-6">
                            <div class="course-features mt-30">
                               <h4>Course Features </h4>
                                <ul>
                                    <li><i class="fa fa-clock-o"></i>Duaration : <span>10 Hours</span></li>
                                    <li><i class="fa fa-clone"></i>Module Available: {{modulecount}}</li>
                                    <li><i class="fa fa-beer"></i>Test Available? :  <span> Yes</span></li>
                                    <li><i class="fa fa-user"></i>Students Enrolled : {{enrollcount}}</li>
                                </ul>
                                <div class="price-button pt-10">
                                    <span>Price : <b>Free</b></span>
                                    <a href="/courseEnroll/{{course.id}}" onclick="return confirm('You wil be enrolled to this course')" class="main-btn">Enroll Now</a>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-12 col-md-6">
                            <div class="You-makelike mt-30">
                                <h4>Other Courses</h4>
                                {% for course in courselike %}
                                <div class="singel-makelike mt-20">
                                    <div class="image">
                                        <img src="{% static 'images/slider-01.jpg'%}" alt="Image">
                                    </div>
                                    <div class="cont">
                                        <a href="/courses/courseDesk/{{course.id}}"><h4>{{course.course_name}}</h4></a>
                                        <ul>
                                            <li><a href="#"><i class="fa fa-user"></i>{{course.id|getEnroll}}</a></li>
                                            <li>Free</li>
                                        </ul>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-8">
                    <div class="releted-courses pt-95">
                        <div class="title">
                            <h3>Releted Courses</h3>
                        </div>
                        <div class="row">
                            {% for course in related %}
                            <div class="col-md-6">
                                <div class="singel-course mt-30">
                                    <div class="thum">
                                        <div class="image">
                                            <img src="/{{course.course_pic}}" alt="Course">
                                        </div>
                                        <div class="price">
                                            <span>Free</span>
                                        </div>
                                    </div>
                                    <div class="cont">
                                        <ul>
                                            {% if course.id|getStars %}
                                            {% for i in course.id|getStars %}
                                                <li><i class="fa fa-star"></i></li>
                                            {% endfor %}
                                            {% else %}
                                                <li><i class="fa fa-star"></i></li>
                                                <li><i class="fa fa-star"></i></li>
                                                <li><i class="fa fa-star"></i></li>
                                                <li><i class="fa fa-star"></i></li>
                                                <li><i class="fa fa-star"></i></li>
                                            {% endif %}
                                        </ul>
                                        <span>({{course.id|getReview}} Reviws)</span>
                                        <a href="/courses/courseDesk/{{course.id}}"><h4>{{course.course_name}}</h4></a>
                                        <div class="course-teacher">
                                            <div class="thum">
                                                <a href="#"><img src="/{{course.user.profile.profile_pic}}" alt="teacher"></a>
                                            </div>
                                            <div class="name">
                                                <a href="#"><h6>{{course.user.profile.firstname}} {{course.user.profile.lastname}}</h6></a>
                                            </div>
                                            <div class="admin">
                                                <ul>
                                                    <li><a href="#"><i class="fa fa-user"></i><span>{{course.id|getEnroll}}</span></a></li>
                                                    {% if request.user|hasLiked:course.id %}
                                                    <li><a><i id="like-{{course.id}}" onclick="like({{course.id}})" class="fa fa-heart" style="cursor:pointer; color:#ffc600"></i><span id="count-{{course.id}}" >{{course.id|getLikes}}</span></a></li>
                                                    {% else %}
                                                    <li><a><i id="like-{{course.id}}" onclick="like({{course.id}})" class="fa fa-heart" style="cursor:pointer;"></i><span id="count-{{course.id}}" >{{course.id|getLikes}}</span></a></li>
                                                    {% endif %}
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </section>
<script>
    function like(id) {
        $.ajax({
            url: '{% url 'courseLike' %}',
            data: {
                'id': id,
            },
            success:function(response){
                var messages = $(response).find('#mesg')
                var messages_c = $(messages).attr('class')
                var text = $('#count-'+id).text();
                $('#mesgg').removeAttr("class");
                $('#mesgg').addClass(messages_c);
                $('#mesgg').text(messages.text());
                $('#mesgg').animate({left:'0px'},600);
                if(messages.text()=="You have saved this course for later"){
                    $('.fa-heart').css('pointer-events', 'none');
                    value =parseInt(text) + 1;
                    $('#count-'+id).empty()
                    $('#count-'+id).append(`${value}`)
                    $('#like-'+id).css("color","#ffc600");
                    window.setTimeout(function() {
                        $('.fa-heart').css('pointer-events', '');
                        $('#mesgg').animate({left:'600px'});
                    }, 3000);
                }else if (messages.text()=="This course has been removed from your wishlist"){
                    $('.fa-heart').css('pointer-events', 'none');
                    value =parseInt(text) - 1;
                    $('#count-'+id).empty()
                    $('#count-'+id).append(`${value}`)
                    $('#like-'+id).css('color', '');
                    window.setTimeout(function() {
                        $('.fa-heart').css('pointer-events', '');
                        $('#mesgg').animate({left:'600px'});
                    }, 3000);
                }
            }
        });
	}
</script>
{% endblock %}
